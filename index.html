<!DOCTYPE html>
<html>
<head>
  <title>Google Sheets API Example</title>
</head>
<body>
  <h1>Google Sheets Data Manager</h1>
  
  <div>
    <h2>Write Data</h2>
    <form id="writeForm">
      <input type="text" id="name" placeholder="Name" required>
      <input type="email" id="email" placeholder="Email" required>
      <button type="submit">Save to Sheet</button>
    </form>
  </div>
  
  <div>
    <h2>Read Data</h2>
    <button id="readData">Load Sheet Data</button>
    <div id="output"></div>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxOpf01vbYCMOICIDPXLsKDtVjA9uc51Ai4wu4gF5j87It-l8V1ZdAeM1ABMIfg6q2H/exec";

// Universal fetch handler
async function callGoogleScript(method, payload = null) {
  try {
    // For GET requests
    if (method === 'GET') {
      const params = new URLSearchParams(payload);
      const url = `${SCRIPT_URL}?${params.toString()}`;
      
      // Use JSONP for GET requests to bypass CORS
      return await jsonpFetch(url);
    }
    // For POST requests
    else {
      // Use a proxy for POST requests
      return await proxyFetch(SCRIPT_URL, payload);
    }
  } catch (error) {
    console.error("API Error:", error);
    throw error;
  }
}

// JSONP implementation for GET requests
function jsonpFetch(url) {
  return new Promise((resolve, reject) => {
    const callbackName = `jsonp_${Date.now()}`;
    const script = document.createElement('script');
    
    window[callbackName] = response => {
      delete window[callbackName];
      document.body.removeChild(script);
      resolve(response);
    };

    script.src = `${url}&callback=${callbackName}`;
    script.onerror = () => {
      delete window[callbackName];
      document.body.removeChild(script);
      reject(new Error('JSONP request failed'));
    };
    
    document.body.appendChild(script);
  });
}

// Proxy solution for POST requests
async function proxyFetch(url, payload) {
  // Use a free CORS proxy service
  const proxyUrl = `https://cors-anywhere.herokuapp.com/${url}`;
  
  const response = await fetch(proxyUrl, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-Requested-With': 'XMLHttpRequest' // Required by some proxies
    },
    body: JSON.stringify(payload)
  });

  if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
  return await response.json();
}

// Example usage
async function writeData(sheetName, data) {
  return await callGoogleScript('POST', {
    action: 'write',
    sheetName: sheetName,
    data: data
  });
}

async function readData(sheetName) {
  return await callGoogleScript('GET', {
    action: 'read',
    sheetName: sheetName
  });
}
  </script>
</body>
</html>
